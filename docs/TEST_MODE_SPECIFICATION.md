# Test Mode - æµ‹è¯•æ¨¡å¼è¯¦ç»†è¯´æ˜

> **ç‰ˆæœ¬**: 1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-16
> **æœ€åæ›´æ–°**: 2025-11-16

---

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
3. [æµ‹è¯•ç±»å‹](#æµ‹è¯•ç±»å‹)
4. [è¯„åˆ†ç³»ç»Ÿ](#è¯„åˆ†ç³»ç»Ÿ)
5. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
6. [ç”¨æˆ·ç•Œé¢](#ç”¨æˆ·ç•Œé¢)
7. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
8. [æ˜Ÿæ˜Ÿå¥–åŠ±](#æ˜Ÿæ˜Ÿå¥–åŠ±)
9. [é”™é¢˜æœ¬ç³»ç»Ÿ](#é”™é¢˜æœ¬ç³»ç»Ÿ)
10. [é›†æˆç‚¹](#é›†æˆç‚¹)

---

## æ¦‚è¿°

Test Modeï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰æ˜¯VocFråº”ç”¨çš„ç»¼åˆèƒ½åŠ›æµ‹è¯•åŠŸèƒ½ï¼Œæ—¨åœ¨å…¨é¢è¯„ä¼°å­¦ä¹ è€…å¯¹æ³•è¯­è¯æ±‡çš„æŒæ¡ç¨‹åº¦ã€‚

### è®¾è®¡ç†å¿µ

```
æ–¹æ¡ˆä¸€ï¼ˆç»¼åˆèƒ½åŠ›æµ‹è¯•ï¼‰+ æ–¹æ¡ˆå››ï¼ˆé”™é¢˜æœ¬ï¼‰
â”œâ”€â”€ å¤šç»´åº¦è¯„ä¼°ï¼šå¬ã€è¯´ã€è¯»ã€å†™ã€è¯æ€§åˆ¤æ–­
â”œâ”€â”€ æ ‡å‡†åŒ–è¯„åˆ†ï¼š20é¢˜æ··åˆæµ‹è¯•
â”œâ”€â”€ é”™é¢˜è¿½è¸ªï¼šæ™ºèƒ½è®°å½•è–„å¼±ç¯èŠ‚
â””â”€â”€ è¿›åº¦åé¦ˆï¼šé›†æˆProgressç³»ç»Ÿ
```

### æ ¸å¿ƒä»·å€¼

- **å…¨é¢è¯„ä¼°**: 4ç§é¢˜å‹è¦†ç›–å¤šä¸ªç»´åº¦
- **ç²¾å‡†è¯Šæ–­**: é”™é¢˜æœ¬å¸®åŠ©å®šä½è–„å¼±ç‚¹
- **æŒç»­æ¿€åŠ±**: æ˜Ÿæ˜Ÿå¥–åŠ±å’Œæˆå°±ç³»ç»Ÿ
- **çµæ´»é€‰æ‹©**: æ”¯æŒå•å…ƒæµ‹è¯•å’Œç»¼åˆæµ‹è¯•

---

## åŠŸèƒ½ç‰¹æ€§

### 1. æµ‹è¯•èŒƒå›´

#### å•å…ƒæµ‹è¯• (Unit Test)
- é€‰æ‹©ç‰¹å®šUniteï¼ˆ1-8ï¼‰è¿›è¡Œæµ‹è¯•
- é¢˜ç›®èŒƒå›´ï¼šè¯¥å•å…ƒå†…æ‰€æœ‰å­¦ä¹ è¿‡çš„è¯æ±‡
- é€‚åˆï¼šå•å…ƒå­¦ä¹ å®Œæˆåçš„å¤ä¹ æµ‹è¯•

#### ç»¼åˆæµ‹è¯• (Comprehensive Test)
- è¦†ç›–æ‰€æœ‰å·²å­¦ä¹ çš„è¯æ±‡
- é¢˜ç›®èŒƒå›´ï¼šå…¨éƒ¨è§£é”å•å…ƒçš„è¯æ±‡
- é€‚åˆï¼šé˜¶æ®µæ€§æ€»å¤ä¹ 

### 2. æµ‹è¯•é…ç½®

| å‚æ•° | é…ç½® |
|------|------|
| æ€»é¢˜æ•° | 20é¢˜ |
| é¢˜å‹åˆ†å¸ƒ | æ¯ç§é¢˜å‹5é¢˜ |
| æ—¶é—´é™åˆ¶ | 10åˆ†é’Ÿï¼ˆ600ç§’ï¼‰ |
| é€šè¿‡æ ‡å‡† | 60åˆ†åŠæ ¼ |

### 3. å®æ—¶åŠŸèƒ½

- â±ï¸ **å€’è®¡æ—¶æ˜¾ç¤º**: æœ€å90ç§’å˜çº¢è‰²æé†’
- ğŸ“Š **è¿›åº¦æ˜¾ç¤º**: å½“å‰é¢˜å·/æ€»é¢˜æ•°ï¼ˆå¦‚"5 / 20"ï¼‰
- â¬…ï¸â¡ï¸ **é¢˜ç›®å¯¼èˆª**: æ”¯æŒå‰åç¿»çœ‹ï¼Œå¯ä¿®æ”¹ç­”æ¡ˆ
- ğŸ’¾ **è‡ªåŠ¨ä¿å­˜**: ç­”æ¡ˆå®æ—¶ä¿å­˜

---

## æµ‹è¯•ç±»å‹

### 1. çœ‹å›¾é€‰è¯ (Image to Word)

#### é¢˜å‹è¯´æ˜
æ˜¾ç¤ºå•è¯å›¾ç‰‡ï¼Œä»4ä¸ªé€‰é¡¹ä¸­é€‰æ‹©æ­£ç¡®çš„æ³•è¯­å•è¯ã€‚

#### ç•Œé¢ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©æ­£ç¡®çš„æ³•è¯­å•è¯      â”‚
â”‚                         â”‚
â”‚  [å›¾ç‰‡: æ©¡çš®]            â”‚
â”‚                         â”‚
â”‚  A. crayon              â”‚
â”‚  B. gomme          âœ“    â”‚
â”‚  C. stylo               â”‚
â”‚  D. livre               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°é€»è¾‘
```swift
private func generateImageToWordQuestion(word: Word, allWords: [Word]) -> TestQuestion? {
    // æ­£ç¡®ç­”æ¡ˆï¼šå½“å‰å•è¯
    var options: [String] = [word.canonical]

    // 3ä¸ªå¹²æ‰°é¡¹ï¼šåŒè¯æ€§çš„å…¶ä»–å•è¯
    let wrongWords = allWords
        .filter { $0.id != word.id && $0.partOfSpeech == word.partOfSpeech }
        .shuffled()
        .prefix(3)

    options.append(contentsOf: wrongWords.map { $0.canonical })
    options.shuffle()

    return TestQuestion(
        type: .imageToWord,
        word: word,
        options: options,
        correctAnswer: word.canonical
    )
}
```

---

### 2. å¬éŸ³è¾¨è¯ (Audio to Word)

#### é¢˜å‹è¯´æ˜
æ’­æ”¾å•è¯å‘éŸ³ï¼Œä»4ä¸ªé€‰é¡¹ä¸­é€‰æ‹©æ­£ç¡®çš„å•è¯ã€‚

#### ç•Œé¢ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¬éŸ³é€‰æ‹©æ­£ç¡®çš„å•è¯      â”‚
â”‚                         â”‚
â”‚  [ğŸ”Š æ’­æ”¾å‘éŸ³]           â”‚
â”‚  (å¯é‡å¤æ’­æ”¾)            â”‚
â”‚                         â”‚
â”‚  A. pomme               â”‚
â”‚  B. porte               â”‚
â”‚  C. livre          âœ“    â”‚
â”‚  D. table               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### éŸ³é¢‘æ’­æ”¾
```swift
Button(action: {
    AudioPlayerManager.shared.playWordAudio(for: word) { _ in }
}) {
    HStack {
        Image(systemName: "play.circle.fill")
            .font(.system(size: 50))
            .foregroundColor(.blue)
        Text("test.button.listen".localized)
    }
}
```

#### ç‰¹æ€§
- ğŸ”Š æ— é™æ¬¡é‡å¤æ’­æ”¾
- ğŸ“± é€‚é…é™éŸ³æ¨¡å¼ï¼ˆæŒ¯åŠ¨æç¤ºï¼‰
- ğŸ¯ å¹²æ‰°é¡¹åŒè¯æ€§ï¼Œå¢åŠ éš¾åº¦

---

### 3. æ‹¼å†™é¢˜ (Spelling)

#### é¢˜å‹è¯´æ˜
çœ‹å›¾æˆ–å¬éŸ³ï¼Œé”®å…¥æ­£ç¡®çš„æ³•è¯­æ‹¼å†™ã€‚

#### ç•Œé¢ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å…¥æ­£ç¡®çš„æ‹¼å†™          â”‚
â”‚                         â”‚
â”‚  [å›¾ç‰‡: é—¨]              â”‚
â”‚  [ğŸ”Š æ’­æ”¾]               â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ porte            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚
â”‚  æç¤ºï¼š5ä¸ªå­—æ¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ‹¼å†™æ£€æŸ¥
```swift
private func checkSpelling(input: String, correct: String) -> Bool {
    // ä¸åŒºåˆ†å¤§å°å†™
    return input.lowercased() == correct.lowercased()
}

// åœ¨TestViewModelä¸­
if question.type == .spelling {
    isCorrect = userAnswer.lowercased() == question.correctAnswer.lowercased()
}
```

#### ç‰¹æ€§
- âŒ¨ï¸ æ”¯æŒæ³•è¯­ç‰¹æ®Šå­—ç¬¦
- ğŸ“ ä¸åŒºåˆ†å¤§å°å†™
- ğŸ’¡ æ˜¾ç¤ºå•è¯é•¿åº¦æç¤º

---

### 4. åè¯é˜´é˜³æ€§ (Gender Guess)

#### é¢˜å‹è¯´æ˜
åˆ¤æ–­æ³•è¯­åè¯çš„æ€§åˆ«ï¼ˆé˜³æ€§/é˜´æ€§ï¼‰ã€‚

#### ç•Œé¢ç¤ºä¾‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©è¿™ä¸ªåè¯çš„æ€§åˆ«      â”‚
â”‚                         â”‚
â”‚  [å›¾ç‰‡: æ©¡çš®]            â”‚
â”‚                         â”‚
â”‚  gomme                  â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é˜³æ€§ (Masculin)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é˜´æ€§ (FÃ©minin)   â”‚âœ“ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ€§åˆ«åˆ¤æ–­é€»è¾‘
```swift
private func generateGenderQuestion(word: Word) -> TestQuestion {
    // ä»WordFormä¸­è¯»å–genderå­—æ®µ
    let correctGender: String
    if let mainForm = word.forms.first(where: { $0.isMainForm }),
       let gender = mainForm.gender {
        correctGender = gender == .masculine ? "masculine" : "feminine"
    } else if let firstForm = word.forms.first,
              let gender = firstForm.gender {
        correctGender = gender == .masculine ? "masculine" : "feminine"
    } else {
        // Fallback: default to masculine
        correctGender = "masculine"
    }

    return TestQuestion(
        type: .genderGuess,
        word: word,
        options: ["masculine", "feminine"],
        correctAnswer: correctGender
    )
}
```

#### ç‰¹æ€§
- ğŸ¯ **ä»…é’ˆå¯¹åè¯**: è‡ªåŠ¨è¿‡æ»¤éåè¯è¯æ€§
- ğŸ“š **æ•°æ®æ¥æº**: ä»JSONæ•°æ®çš„`genderOrPos`å­—æ®µè¯»å–
- âœ… **å‡†ç¡®æ€§ä¿è¯**: ç›´æ¥ä½¿ç”¨WordForm.genderï¼Œé¿å…è§£æé”™è¯¯

---

## è¯„åˆ†ç³»ç»Ÿ

### 1. åˆ†æ•°è®¡ç®—

```swift
let score = Int(Double(correctAnswers) / Double(totalQuestions) * 100)
// ä¾‹å¦‚ï¼š20é¢˜ç­”å¯¹18é¢˜ = (18/20) * 100 = 90åˆ†
```

### 2. æ˜Ÿçº§è¯„å®š

| åˆ†æ•°èŒƒå›´ | æ˜Ÿçº§ | è¯„ä»· | è¯´æ˜ |
|---------|------|------|------|
| 90-100 | â­â­â­ | Excellent! | ä¼˜ç§€ |
| 75-89 | â­â­ | Good! | è‰¯å¥½ |
| 60-74 | â­ | Pass | åŠæ ¼ |
| 0-59 | - | Needs Review | éœ€è¦å¤ä¹  |

```swift
var starRating: Int {
    if score >= 90 { return 3 }
    if score >= 75 { return 2 }
    if score >= 60 { return 1 }
    return 0
}
```

### 3. è¯„ä»·æ–‡æœ¬

```swift
var ratingText: String {
    switch starRating {
    case 3:
        return "test.rating.excellent".localized  // "ä¼˜ç§€ï¼"
    case 2:
        return "test.rating.good".localized       // "è‰¯å¥½ï¼"
    case 1:
        return "test.rating.pass".localized       // "åŠæ ¼"
    default:
        return "test.rating.review".localized     // "éœ€è¦å¤ä¹ "
    }
}
```

---

## æ•°æ®æ¨¡å‹

### 1. TestQuestion - æµ‹è¯•é¢˜ç›®

```swift
struct TestQuestion: Identifiable {
    let id: String              // UUID
    let type: TestQuestionType  // é¢˜å‹
    let word: Word              // å…³è”å•è¯
    let options: [String]       // é€‰é¡¹ï¼ˆé€‰æ‹©é¢˜ï¼‰
    let correctAnswer: String   // æ­£ç¡®ç­”æ¡ˆ
}

enum TestQuestionType: String, Codable {
    case imageToWord      // çœ‹å›¾é€‰è¯
    case audioToWord      // å¬éŸ³è¾¨è¯
    case spelling         // æ‹¼å†™é¢˜
    case genderGuess      // åè¯æ€§åˆ«åˆ¤æ–­
}
```

### 2. TestResult - æµ‹è¯•ç»“æœ

```swift
struct TestResult {
    let score: Int                          // åˆ†æ•° (0-100)
    let totalQuestions: Int                 // æ€»é¢˜æ•° (20)
    let correctAnswers: Int                 // æ­£ç¡®é¢˜æ•°
    let timeSpent: TimeInterval             // ç”¨æ—¶ï¼ˆç§’ï¼‰
    let questionResults: [QuestionResult]   // æ¯é¢˜è¯¦æƒ…

    var starRating: Int {
        // æ˜Ÿçº§è¯„å®š
    }

    var ratingText: String {
        // è¯„ä»·æ–‡æœ¬
    }
}
```

### 3. QuestionResult - å•é¢˜ç»“æœ

```swift
struct QuestionResult {
    let questionId: String
    let questionType: TestQuestionType
    let wordId: String
    let userAnswer: String
    let correctAnswer: String
    let isCorrect: Bool
    let timeSpent: TimeInterval
}
```

### 4. TestRecord - æµ‹è¯•è®°å½•ï¼ˆæŒä¹…åŒ–ï¼‰

```swift
@Model
final class TestRecord {
    var id: String
    var date: Date
    var uniteId: String?           // nil = ç»¼åˆæµ‹è¯•
    var uniteNumber: Int?
    var score: Int
    var totalQuestions: Int
    var correctAnswers: Int
    var timeSpent: TimeInterval
    var questionResults: [QuestionResult]

    init(uniteId: String?, uniteNumber: Int?, score: Int,
         totalQuestions: Int, correctAnswers: Int,
         timeSpent: TimeInterval, questionResults: [QuestionResult]) {
        self.id = UUID().uuidString
        self.date = Date()
        self.uniteId = uniteId
        self.uniteNumber = uniteNumber
        self.score = score
        self.totalQuestions = totalQuestions
        self.correctAnswers = correctAnswers
        self.timeSpent = timeSpent
        self.questionResults = questionResults
    }
}
```

---

## ç”¨æˆ·ç•Œé¢

### 1. æµ‹è¯•é€‰æ‹©ç•Œé¢ (TestSelectionView)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Test Mode               â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç»¼åˆæµ‹è¯•             â”‚   â”‚
â”‚  â”‚ All Units           â”‚   â”‚
â”‚  â”‚ 218 words          â”‚   â”‚
â”‚  â”‚ Best: 85 â­â­       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ UnitÃ© 1 : A l'Ã©cole â”‚   â”‚
â”‚  â”‚ 77 words           â”‚   â”‚
â”‚  â”‚ Best: 90 â­â­â­     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ UnitÃ© 2 : Les sportsâ”‚   â”‚
â”‚  â”‚ 65 words           â”‚   â”‚
â”‚  â”‚ Best: -- (æœªæµ‹è¯•)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç‰¹æ€§
- ğŸ“Š æ˜¾ç¤ºæœ€ä½³æˆç»©
- ğŸ”’ æœªè§£é”å•å…ƒæ˜¾ç¤ºé”å®šçŠ¶æ€
- ğŸ“ˆ æ˜¾ç¤ºå•è¯æ•°é‡

---

### 2. æµ‹è¯•è¿›è¡Œç•Œé¢ (TestSessionView)

#### é¡¶éƒ¨è¿›åº¦æ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5 / 20        â±ï¸ 07:32     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é¢˜ç›®åŒºåŸŸ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©æ­£ç¡®çš„æ³•è¯­å•è¯          â”‚
â”‚                             â”‚
â”‚  [å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸ]              â”‚
â”‚                             â”‚
â”‚  â—‹ A. option1               â”‚
â”‚  â—‹ B. option2               â”‚
â”‚  â—‹ C. option3               â”‚
â”‚  â—‹ D. option4               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åº•éƒ¨å¯¼èˆª
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† ä¸Šä¸€é¢˜]  [ä¸‹ä¸€é¢˜ â†’]      â”‚
â”‚         [æäº¤æµ‹è¯•]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. ç»“æœå±•ç¤ºç•Œé¢ (TestResultView)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ‰ æµ‹è¯•å®Œæˆ          â”‚
â”‚                             â”‚
â”‚      â­ â­ â­               â”‚
â”‚                             â”‚
â”‚          90                 â”‚
â”‚       ä¼˜ç§€ï¼                â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ­£ç¡®: 18/20         â”‚   â”‚
â”‚  â”‚ ç”¨æ—¶: 08:32         â”‚   â”‚
â”‚  â”‚                     â”‚   â”‚
â”‚  â”‚ çœ‹å›¾é€‰è¯: 5/5  âœ“    â”‚   â”‚
â”‚  â”‚ å¬éŸ³è¾¨è¯: 4/5       â”‚   â”‚
â”‚  â”‚ æ‹¼å†™é¢˜:   5/5  âœ“    â”‚   â”‚
â”‚  â”‚ è¯æ€§åˆ¤æ–­: 4/5       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  [æŸ¥çœ‹é”™é¢˜æœ¬]  [è¿”å›]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯å®ç°

### 1. TestViewModel - æ ¸å¿ƒé€»è¾‘

```swift
@Observable
class TestViewModel {
    // MARK: - Properties
    let unite: Unite?                       // nil = ç»¼åˆæµ‹è¯•
    private let modelContext: ModelContext?

    var questions: [TestQuestion] = []      // æ‰€æœ‰é¢˜ç›®
    var currentIndex: Int = 0               // å½“å‰é¢˜å·
    var answers: [String: String] = [:]     // ç­”æ¡ˆè®°å½•
    var startTime: Date = Date()            // å¼€å§‹æ—¶é—´
    var timeLimit: TimeInterval = 600       // 10åˆ†é’Ÿ
    var elapsedTime: TimeInterval = 0       // å·²ç”¨æ—¶é—´

    // MARK: - Setup
    private func setupQuestions() {
        // 1. æ”¶é›†å•è¯
        var words: [Word] = []
        // ... ä»uniteæˆ–æ‰€æœ‰unitesæ”¶é›†

        // 2. ç”Ÿæˆé¢˜ç›®ï¼ˆæ¯ç§5é¢˜ï¼‰
        var generatedQuestions: [TestQuestion] = []

        // çœ‹å›¾é€‰è¯ x5
        let imageWords = words.shuffled().prefix(5)
        for word in imageWords {
            if let q = generateImageToWordQuestion(word: word, allWords: words) {
                generatedQuestions.append(q)
            }
        }

        // å¬éŸ³è¾¨è¯ x5
        // æ‹¼å†™é¢˜ x5
        // è¯æ€§åˆ¤æ–­ x5 (ä»…åè¯)

        // 3. æ‰“ä¹±é¡ºåº
        questions = generatedQuestions.shuffled()
    }

    // MARK: - Actions
    func submitAnswer(_ answer: String) {
        guard let question = currentQuestion else { return }
        answers[question.id] = answer
    }

    func finishTest() -> TestResult {
        // 1. è®¡ç®—æˆç»©
        var correctCount = 0
        var questionResults: [QuestionResult] = []

        for question in questions {
            let userAnswer = answers[question.id] ?? ""
            let isCorrect = checkAnswer(userAnswer, for: question)

            if isCorrect { correctCount += 1 }

            questionResults.append(QuestionResult(
                questionId: question.id,
                questionType: question.type,
                wordId: question.word.id,
                userAnswer: userAnswer,
                correctAnswer: question.correctAnswer,
                isCorrect: isCorrect,
                timeSpent: 0
            ))

            // 2. ä¿å­˜é”™é¢˜
            if !isCorrect {
                saveWrongAnswer(question: question, userAnswer: userAnswer)
            }
        }

        // 3. ç”Ÿæˆç»“æœ
        let score = Int(Double(correctCount) / Double(questions.count) * 100)
        let result = TestResult(
            score: score,
            totalQuestions: questions.count,
            correctAnswers: correctCount,
            timeSpent: elapsedTime,
            questionResults: questionResults
        )

        // 4. ä¿å­˜è®°å½•
        saveTestRecord(result: result)

        return result
    }
}
```

---

### 2. æ€§åˆ«åˆ¤æ–­ä¿®å¤

**é—®é¢˜**: ä¹‹å‰ä»`word.canonical`è§£æå† è¯æ¥åˆ¤æ–­æ€§åˆ«ï¼Œä½†canonicalä¸åŒ…å«å† è¯ã€‚

**è§£å†³æ–¹æ¡ˆ**: ä»`WordForm.gender`å­—æ®µç›´æ¥è¯»å–

```swift
// âŒ é”™è¯¯æ–¹æ³•ï¼ˆå·²åºŸå¼ƒï¼‰
if word.canonical.hasPrefix("le ") {
    correctGender = "masculine"
}

// âœ… æ­£ç¡®æ–¹æ³•ï¼ˆå½“å‰å®ç°ï¼‰
if let mainForm = word.forms.first(where: { $0.isMainForm }),
   let gender = mainForm.gender {
    correctGender = gender == .masculine ? "masculine" : "feminine"
}
```

---

### 3. æ•°æ®æ¥æº

```json
// vocabulary.json
{
  "canonical": "gomme",
  "chinese": "æ©¡çš®",
  "partOfSpeech": "noun",
  "genderOrPos": "feminine",  // â† æ€§åˆ«æ•°æ®æº
  "category": "school_objects",
  "elision": false
}
```

åŠ è½½æ—¶è½¬æ¢ä¸ºï¼š
```swift
WordForm(
    formType: .singular,
    french: "la gomme",
    articleOnly: "la",
    gender: .feminine,    // â† å­˜å‚¨åœ¨è¿™é‡Œ
    number: .singular,
    isMainForm: true
)
```

---

## æ˜Ÿæ˜Ÿå¥–åŠ±

### å¥–åŠ±è§„åˆ™

```swift
// æ˜Ÿæ˜Ÿ = åˆ†æ•° Ã· 10
let stars = result.score / 10

// ç¤ºä¾‹ï¼š
// 100åˆ† â†’ 10æ˜Ÿ
//  90åˆ† â†’ 9æ˜Ÿ
//  85åˆ† â†’ 8æ˜Ÿ
//  75åˆ† â†’ 7æ˜Ÿ
//  60åˆ† â†’ 6æ˜Ÿ
```

### å®ç°ä»£ç 

```swift
private func saveTestRecord(result: TestResult) {
    // ... ä¿å­˜TestRecord

    // Award stars based on performance
    let stars = result.score / 10
    if stars > 0 {
        PointsManager.shared.awardStars(
            points: stars,
            modelContext: modelContext,
            reason: "Test completed with score \(result.score)"
        )
    }
}
```

---

## é”™é¢˜æœ¬ç³»ç»Ÿ

### 1. WrongAnswerRecord - é”™é¢˜è®°å½•

```swift
@Model
final class WrongAnswerRecord {
    var id: String
    var wordId: String              // å•è¯ID
    var questionType: String        // é¢˜å‹
    var userAnswer: String          // é”™è¯¯ç­”æ¡ˆ
    var correctAnswer: String       // æ­£ç¡®ç­”æ¡ˆ
    var wrongCount: Int             // é”™è¯¯æ¬¡æ•°
    var lastWrongDate: Date         // æœ€è¿‘é”™è¯¯æ—¥æœŸ
    var isMastered: Bool            // æ˜¯å¦å·²æŒæ¡

    init(wordId: String, questionType: TestQuestionType,
         userAnswer: String, correctAnswer: String) {
        self.id = UUID().uuidString
        self.wordId = wordId
        self.questionType = questionType.rawValue
        self.userAnswer = userAnswer
        self.correctAnswer = correctAnswer
        self.wrongCount = 1
        self.lastWrongDate = Date()
        self.isMastered = false
    }
}
```

### 2. é”™é¢˜ä¿å­˜é€»è¾‘

```swift
private func saveWrongAnswer(question: TestQuestion, userAnswer: String) {
    guard let modelContext = modelContext else { return }

    let wordId = question.word.id
    let questionTypeValue = question.type.rawValue

    // æŸ¥è¯¢æ˜¯å¦å·²æœ‰è®°å½•
    let descriptor = FetchDescriptor<WrongAnswerRecord>(
        predicate: #Predicate { record in
            record.wordId == wordId &&
            record.questionType == questionTypeValue
        }
    )

    if let existing = try? modelContext.fetch(descriptor).first {
        // æ›´æ–°å·²æœ‰è®°å½•
        existing.lastWrongDate = Date()
        existing.wrongCount += 1
        existing.userAnswer = userAnswer
    } else {
        // åˆ›å»ºæ–°è®°å½•
        let record = WrongAnswerRecord(
            wordId: question.word.id,
            questionType: question.type,
            userAnswer: userAnswer,
            correctAnswer: question.correctAnswer
        )
        modelContext.insert(record)
    }

    try? modelContext.save()
}
```

### 3. é”™é¢˜æœ¬ç•Œé¢ (WrongAnswerBookView)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“• é”™é¢˜æœ¬                   â”‚
â”‚                             â”‚
â”‚  å…± 5 é“é”™é¢˜                â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ gomme              â”‚   â”‚
â”‚  â”‚ å¬éŸ³è¾¨è¯            â”‚   â”‚
â”‚  â”‚ ä½ çš„ç­”æ¡ˆ: gommes    â”‚   â”‚
â”‚  â”‚ æ­£ç¡®ç­”æ¡ˆ: gomme     â”‚   â”‚
â”‚  â”‚ é”™è¯¯æ¬¡æ•°: 2æ¬¡       â”‚   â”‚
â”‚  â”‚ [æ ‡è®°ä¸ºå·²æŒæ¡]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ porte              â”‚   â”‚
â”‚  â”‚ è¯æ€§åˆ¤æ–­            â”‚   â”‚
â”‚  â”‚ ä½ çš„ç­”æ¡ˆ: masculine â”‚   â”‚
â”‚  â”‚ æ­£ç¡®ç­”æ¡ˆ: feminine  â”‚   â”‚
â”‚  â”‚ é”™è¯¯æ¬¡æ•°: 1æ¬¡       â”‚   â”‚
â”‚  â”‚ [æ ‡è®°ä¸ºå·²æŒæ¡]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é›†æˆç‚¹

### 1. Progressé¡µé¢é›†æˆ

```swift
// TestViewModel.swift
private func saveTestRecord(result: TestResult) {
    // ... ä¿å­˜TestRecord

    // åˆ›å»ºPracticeRecordç”¨äºProgressé¡µé¢
    let sessionTypeName: String
    if let unite = unite {
        sessionTypeName = "Test - UnitÃ© \(unite.number)"
    } else {
        sessionTypeName = "Test - Comprehensive"
    }

    let practiceRecord = PracticeRecord(
        sessionDate: Date(),
        sessionType: sessionTypeName,
        wordsStudied: result.totalQuestions,
        accuracy: Double(result.correctAnswers) / Double(result.totalQuestions),
        timeSpent: result.timeSpent
    )

    modelContext.insert(practiceRecord)
}
```

### 2. Recent Activityæ˜¾ç¤º

```
Progressé¡µé¢ â†’ Recent Activity:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Test - UnitÃ© 1             â”‚
â”‚  2025-11-16  20 words       â”‚
â”‚  æ­£ç¡®ç‡: 90%  ç”¨æ—¶: 8:32     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœ¬åœ°åŒ–

### å…³é”®å­—ç¬¦ä¸²

```swift
// æµ‹è¯•ç±»å‹
"test.question.imageToWord" = "é€‰æ‹©æ­£ç¡®çš„æ³•è¯­å•è¯"
"test.question.audioToWord" = "å¬éŸ³é€‰æ‹©æ­£ç¡®çš„å•è¯"
"test.question.spelling" = "è¾“å…¥æ­£ç¡®çš„æ‹¼å†™"
"test.question.genderGuess" = "é€‰æ‹©è¿™ä¸ªåè¯çš„æ€§åˆ«"

// æ€§åˆ«
"test.gender.masculine" = "é˜³æ€§ (Masculin)"
"test.gender.feminine" = "é˜´æ€§ (FÃ©minin)"

// æŒ‰é’®
"test.button.listen" = "æ’­æ”¾å‘éŸ³"
"test.button.submit" = "æäº¤æµ‹è¯•"
"test.button.next" = "ä¸‹ä¸€é¢˜"
"test.button.previous" = "ä¸Šä¸€é¢˜"
"test.button.viewWrong" = "æŸ¥çœ‹é”™é¢˜æœ¬"

// è¯„ä»·
"test.rating.excellent" = "ä¼˜ç§€ï¼"
"test.rating.good" = "è‰¯å¥½ï¼"
"test.rating.pass" = "åŠæ ¼"
"test.rating.review" = "éœ€è¦å¤ä¹ "

// ç»¼åˆæµ‹è¯•
"test.comprehensive" = "ç»¼åˆæµ‹è¯•"
"test.all.units" = "å…¨éƒ¨å•å…ƒ"
```

---

## æ–‡ä»¶ç»“æ„

```
VocFr/
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ TestModels.swift           // æ•°æ®æ¨¡å‹
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ TestViewModel.swift        // æµ‹è¯•é€»è¾‘
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ Practice/
â”‚       â”œâ”€â”€ TestModeView.swift     // å…¥å£
â”‚       â”œâ”€â”€ TestSelectionView.swift    // é€‰æ‹©ç•Œé¢
â”‚       â”œâ”€â”€ TestSessionView.swift      // æµ‹è¯•ç•Œé¢
â”‚       â”œâ”€â”€ TestResultView.swift       // ç»“æœç•Œé¢
â”‚       â””â”€â”€ WrongAnswerBookView.swift  // é”™é¢˜æœ¬
â””â”€â”€ {language}.lproj/
    â””â”€â”€ Localizable.strings        // æœ¬åœ°åŒ–å­—ç¬¦ä¸²
```

---

## æ€»ç»“

### å·²å®ç°åŠŸèƒ½ âœ…

- [x] 4ç§æµ‹è¯•é¢˜å‹ï¼ˆçœ‹å›¾é€‰è¯ã€å¬éŸ³è¾¨è¯ã€æ‹¼å†™é¢˜ã€è¯æ€§åˆ¤æ–­ï¼‰
- [x] å•å…ƒæµ‹è¯•å’Œç»¼åˆæµ‹è¯•
- [x] 20é¢˜æ··åˆæµ‹è¯•ï¼Œ10åˆ†é’Ÿæ—¶é™
- [x] æ˜Ÿçº§è¯„åˆ†ç³»ç»Ÿï¼ˆâ­â­â­ï¼‰
- [x] æ˜Ÿæ˜Ÿå¥–åŠ±ï¼ˆåˆ†æ•°Ã·10ï¼‰
- [x] é”™é¢˜æœ¬ç³»ç»Ÿ
- [x] Progressé¡µé¢é›†æˆ
- [x] 7ç§è¯­è¨€æœ¬åœ°åŒ–æ”¯æŒ
- [x] æ€§åˆ«åˆ¤æ–­å‡†ç¡®æ€§ä¿®å¤

### æœªæ¥ä¼˜åŒ–æ–¹å‘ ğŸš€

- [ ] é¢˜ç›®éš¾åº¦è‡ªé€‚åº”
- [ ] é”™é¢˜é‡ç‚¹å¤ä¹ æ¨¡å¼
- [ ] æµ‹è¯•å†å²è¯¦ç»†åˆ†æ
- [ ] å•è¯æŒæ¡åº¦å¯è§†åŒ–
- [ ] æµ‹è¯•æ’è¡Œæ¦œ
- [ ] è‡ªå®šä¹‰æµ‹è¯•é…ç½®ï¼ˆé¢˜æ•°ã€æ—¶é™ã€é¢˜å‹ï¼‰

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Claude
**æŠ€æœ¯æ ˆ**: SwiftUI, SwiftData, AVFoundation
**æœ€åæµ‹è¯•**: 2025-11-16
