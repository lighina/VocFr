# VocFr - 基准测试文档

**文档版本**: 1.0
**创建日期**: 2025-11-11
**目的**: 记录重构前的基准数据，用于验证重构后的改进

---

## 目录
1. [测试环境](#测试环境)
2. [性能基准](#性能基准)
3. [功能测试清单](#功能测试清单)
4. [代码质量指标](#代码质量指标)
5. [测试步骤](#测试步骤)
6. [验收标准](#验收标准)

---

## 测试环境

### 硬件配置
- **设备**: iPhone/iPad 模拟器
- **iOS 版本**: iOS 18.0+
- **Xcode 版本**: 15.0+
- **测试日期**: 2025-11-11

### 软件配置
- **Swift 版本**: 5.9+
- **SwiftUI 版本**: iOS 18.0+
- **SwiftData 版本**: iOS 18.0+

---

## 性能基准

### 1. 启动性能

#### 测试指标
| 指标 | 测量方法 | 基准值 | 目标值 | 测试状态 |
|------|----------|--------|--------|----------|
| 冷启动时间 | 从点击图标到 WelcomeView 显示 | TBM | < 2.0s | ⏳ 待测 |
| 热启动时间 | 从后台恢复到界面显示 | TBM | < 0.5s | ⏳ 待测 |
| 首次数据加载 | seedAllData() 执行时间 | TBM | < 3.0s | ⏳ 待测 |
| 内存占用（启动后） | Xcode Instruments | TBM | < 50MB | ⏳ 待测 |

**TBM** = To Be Measured (待测量)

#### 测试步骤
1. 删除应用并重新安装（模拟首次启动）
2. 使用 Xcode Time Profiler 测量启动时间
3. 观察控制台输出的数据导入时间
4. 使用 Instruments 监控内存使用情况

### 2. 数据加载性能

#### 测试指标
| 操作 | 测量方法 | 基准值 | 目标值 | 测试状态 |
|------|----------|--------|--------|----------|
| UnitsView 加载 | 导航到单元列表 | TBM | < 0.3s | ⏳ 待测 |
| SectionDetailView 加载 | 进入章节详情 | TBM | < 0.3s | ⏳ 待测 |
| WordDetailView 加载 | 进入单词详情 | TBM | < 0.5s | ⏳ 待测 |
| SwiftData 查询时间 | 平均查询响应时间 | TBM | < 0.1s | ⏳ 待测 |

#### 测试步骤
1. 在各个视图加载时使用 `Date()` 记录时间戳
2. 计算从触发导航到视图显示的时间差
3. 多次测试取平均值

### 3. 音频播放性能

#### 测试指标
| 操作 | 测量方法 | 基准值 | 目标值 | 测试状态 |
|------|----------|--------|--------|----------|
| 完整音频播放启动 | 点击播放到声音开始 | TBM | < 0.3s | ⏳ 待测 |
| 音频片段播放启动 | 点击片段到声音开始 | TBM | < 0.3s | ⏳ 待测 |
| 音频切换响应时间 | 停止当前并播放下一个 | TBM | < 0.2s | ⏳ 待测 |
| 音频内存占用 | 播放时的额外内存 | TBM | < 10MB | ⏳ 待测 |

#### 测试步骤
1. 在 `AudioPlayerManager.playAudio()` 开始和音频实际播放之间记录时间
2. 使用 Instruments Audio 工具监控音频延迟
3. 监控播放过程中的内存变化

### 4. UI 响应性能

#### 测试指标
| 操作 | 测量方法 | 基准值 | 目标值 | 测试状态 |
|------|----------|--------|--------|----------|
| 列表滚动流畅度 | FPS (帧率) | TBM | 60 FPS | ⏳ 待测 |
| 按钮点击响应 | 点击到视觉反馈 | TBM | < 0.1s | ⏳ 待测 |
| 导航动画流畅度 | 页面切换 FPS | TBM | 60 FPS | ⏳ 待测 |
| 图片加载时间 | 单词图片显示延迟 | TBM | < 0.2s | ⏳ 待测 |

#### 测试步骤
1. 使用 Xcode Debug → View Debugging → Rendering
2. 启用 FPS 监控
3. 测试各种交互操作的帧率

---

## 功能测试清单

### 1. 核心功能测试

#### 1.1 欢迎界面 ✅
- [ ] **WV-01**: 应用首次启动显示 WelcomeView
- [ ] **WV-02**: "开始学习" 按钮可点击
- [ ] **WV-03**: 点击按钮后平滑过渡到 MainAppView
- [ ] **WV-04**: 界面显示三个特性说明
- [ ] **WV-05**: 渐变背景正常显示

#### 1.2 主应用界面 ✅
- [ ] **MA-01**: 显示三个模式按钮（学习、答题、游戏）
- [ ] **MA-02**: 学习模式按钮可点击并导航到 UnitsView
- [ ] **MA-03**: 答题模式按钮可点击并导航到 TestModeView
- [ ] **MA-04**: 游戏模式按钮显示为禁用状态
- [ ] **MA-05**: 左上角菜单按钮可点击并显示 MenuView
- [ ] **MA-06**: 导航标题显示为"法语学习"

#### 1.3 单元浏览功能 ✅
- [ ] **UN-01**: UnitsView 显示所有单元列表
- [ ] **UN-02**: 单元按编号正确排序（Unité 1, 2, 3...）
- [ ] **UN-03**: 每个单元显示标题和章节数量
- [ ] **UN-04**: 已解锁单元显示✓标记
- [ ] **UN-05**: 未解锁单元显示🔒图标和所需星星数
- [ ] **UN-06**: 点击已解锁单元导航到 UniteDetailView
- [ ] **UN-07**: 点击未解锁单元无响应（disabled）
- [ ] **UN-08**: 工具栏显示"Import Data"按钮

#### 1.4 章节浏览功能 ✅
- [ ] **SE-01**: UniteDetailView 显示选定单元的所有章节
- [ ] **SE-02**: 章节按 orderIndex 正确排序
- [ ] **SE-03**: 每个章节显示名称和单词数量
- [ ] **SE-04**: 点击章节导航到 SectionDetailView
- [ ] **SE-05**: SectionDetailView 显示章节内的所有单词
- [ ] **SE-06**: 单词按 orderIndex 正确排序
- [ ] **SE-07**: 工具栏显示"练习"按钮
- [ ] **SE-08**: 点击"练习"按钮导航到 PracticeView

#### 1.5 单词学习功能 ✅
- [ ] **WO-01**: WordDetailView 显示单词图片
- [ ] **WO-02**: 显示中文翻译
- [ ] **WO-03**: 显示法语文本
- [ ] **WO-04**: 显示词性标签
- [ ] **WO-05**: 显示所有单词形式（阳性/阴性、单数/复数）
- [ ] **WO-06**: 完整音频播放按钮可用
- [ ] **WO-07**: 点击播放按钮开始播放音频
- [ ] **WO-08**: 音频播放时按钮变为暂停图标
- [ ] **WO-09**: 音频播放完毕后自动恢复播放图标
- [ ] **WO-10**: 音频片段播放按钮可用（如果有片段数据）
- [ ] **WO-11**: "上一个"按钮导航到前一个单词
- [ ] **WO-12**: "下一个"按钮导航到后一个单词
- [ ] **WO-13**: 第一个单词时"上一个"按钮禁用
- [ ] **WO-14**: 最后一个单词时"下一个"按钮禁用

#### 1.6 音频播放功能 ✅
- [ ] **AU-01**: AudioPlayerManager.shared 单例正常工作
- [ ] **AU-02**: 可以播放 wav 格式音频
- [ ] **AU-03**: 可以播放 mp3 格式音频
- [ ] **AU-04**: 可以播放 m4a 格式音频
- [ ] **AU-05**: 可以播放 aac 格式音频
- [ ] **AU-06**: 自动解析文件扩展名
- [ ] **AU-07**: 音频片段播放在指定时间停止
- [ ] **AU-08**: stopAudio() 正确停止播放
- [ ] **AU-09**: togglePlayback() 正确切换播放状态
- [ ] **AU-10**: isPlaying 状态与实际播放状态同步

#### 1.7 数据加载功能 ✅
- [ ] **DA-01**: 首次启动时自动调用 seedAllData()
- [ ] **DA-02**: 创建 Unite 1 数据
- [ ] **DA-03**: 创建 6 个 Section 数据
- [ ] **DA-04**: 创建所有 Word 数据
- [ ] **DA-05**: 创建所有 WordForm 数据
- [ ] **DA-06**: 建立 SectionWord 关联
- [ ] **DA-07**: 音频时间戳正确添加
- [ ] **DA-08**: 数据验证无错误
- [ ] **DA-09**: 控制台输出数据报告
- [ ] **DA-10**: 后续启动不重复播种数据

### 2. 边界情况测试

#### 2.1 数据边界
- [ ] **BD-01**: 空单元列表处理（不应发生）
- [ ] **BD-02**: 空章节列表处理
- [ ] **BD-03**: 单词无图片时的处理
- [ ] **BD-04**: 单词无音频时的处理
- [ ] **BD-05**: 单词无形式数据时的处理

#### 2.2 音频边界
- [ ] **AB-01**: 音频文件不存在时的错误处理
- [ ] **AB-02**: 音频解码失败时的错误处理
- [ ] **AB-03**: 音频片段时间超出文件长度时的处理
- [ ] **AB-04**: 快速连续点击播放按钮的处理
- [ ] **AB-05**: 在音频播放中导航到其他页面的处理

#### 2.3 导航边界
- [ ] **NB-01**: 深层导航后返回按钮正常工作
- [ ] **NB-02**: 快速连续点击导航按钮的处理
- [ ] **NB-03**: 在加载过程中返回的处理

### 3. 错误处理测试

#### 3.1 数据错误
- [ ] **DE-01**: SwiftData 创建失败时的 fatalError 处理
- [ ] **DE-02**: 数据播种失败时的错误日志
- [ ] **DE-03**: 数据验证失败时的问题输出

#### 3.2 音频错误
- [ ] **AE-01**: 音频文件未找到的错误提示
- [ ] **AE-02**: 音频播放失败的回调处理
- [ ] **AE-03**: 音频会话设置失败的错误日志

---

## 代码质量指标

### 1. 代码结构

| 指标 | 当前值 | 目标值 | 状态 |
|------|--------|--------|------|
| 总文件数 | 19 | - | - |
| 总代码行数 | ~4,089 | < 5,000 | ✅ |
| 最大文件行数 | 1,462 | < 300 | ❌ |
| 平均文件行数 | ~215 | < 200 | ⚠️ |
| 视图文件数 | 11 | - | - |
| 模型文件数 | 1 | 5-10 | ❌ |
| 服务文件数 | 1 | 3-5 | ❌ |

### 2. 复杂度指标

| 文件 | 行数 | 循环复杂度 | 问题 |
|------|------|------------|------|
| FrenchWord.swift | 1,462 | 高 | 单一文件过大 |
| WordView.swift | 571 | 中-高 | 视图逻辑复杂 |
| Models.swift | 248 | 低 | 所有模型在一个文件 |
| AudioPlayerManager.swift | 169 | 中 | 单例模式 |
| UniteView.swift | 119 | 低 | 可接受 |
| MainAppView.swift | 129 | 低 | 可接受 |

### 3. 依赖关系

```
当前依赖图（简化）:

Views → SwiftData Models → Data Seeding
  ↓
AudioPlayerManager (Singleton)
```

**问题**:
- 视图直接依赖 SwiftData 模型
- 缺少 ViewModel 抽象层
- AudioPlayerManager 使用单例，难以测试

### 4. 测试覆盖率

| 模块 | 单元测试 | UI测试 | 集成测试 | 总覆盖率 |
|------|----------|--------|----------|----------|
| Models | ❌ | - | - | 0% |
| Views | - | ⚠️ | - | 低 |
| AudioPlayerManager | ❌ | - | - | 0% |
| Data Seeding | ❌ | - | - | 0% |
| **总体** | **低** | **低** | **无** | **< 20%** |

---

## 测试步骤

### Phase 0 基准测试步骤

#### 步骤 1: 性能测量（在 Mac 上执行）

```bash
# 1. 打开 Xcode 项目
open VocFr.xcodeproj

# 2. 选择目标设备（iPhone 15 模拟器或真机）

# 3. 运行 Time Profiler
# Xcode → Product → Profile → Time Profiler

# 4. 执行以下操作并记录时间:
#    - 应用启动（冷启动）
#    - 导航到 UnitsView
#    - 导航到 SectionDetailView
#    - 导航到 WordDetailView
#    - 播放音频

# 5. 记录结果到本文档
```

#### 步骤 2: 功能测试（在 Mac 上执行）

```bash
# 1. 在 Xcode 中运行应用
# 2. 按照"功能测试清单"逐项测试
# 3. 在清单中标记测试结果
# 4. 记录发现的任何问题到 ISSUES.md
```

#### 步骤 3: 自动化测试（在 Mac 上执行）

```bash
# 1. 运行单元测试
# Xcode → Product → Test (Cmd+U)

# 2. 运行 UI 测试
# 选择 VocFrUITests scheme 并运行

# 3. 查看测试报告
# Xcode → Report Navigator → Test Results

# 4. 记录测试覆盖率
# Xcode → Report Navigator → Coverage
```

#### 步骤 4: 代码质量分析（可选）

```bash
# 如果有 SwiftLint:
swiftlint lint --reporter html > swiftlint_report.html

# 如果有其他静态分析工具，执行相应命令
```

---

## 验收标准

### Phase 0 完成标准

- ✅ 创建 `refactor/phase-0-preparation` 分支
- ✅ 完成 `CURRENT_FEATURES.md` 文档
- ✅ 完成 `BASELINE_TESTING.md` 文档（本文档）
- ⏳ 用户在 Mac 上执行基准测试并记录结果
- ⏳ 所有关键功能测试项通过（>90%）
- ⏳ 记录性能基准值
- ⏳ 提交 Phase 0 代码到分支

### Phase 1-5 验收标准

每个阶段完成后，需要验证：

1. **功能完整性**: 所有现有功能正常工作（参考功能测试清单）
2. **性能不降级**: 性能指标不低于基准值
3. **测试通过**: 所有单元测试和 UI 测试通过
4. **代码质量提升**: 相关代码质量指标改善

---

## 测试结果记录区

### 性能测试结果（待用户在 Mac 上填写）

```
测试日期: _______________
测试设备: _______________
iOS 版本: _______________

启动性能:
- 冷启动时间: _______ 秒
- 热启动时间: _______ 秒
- 首次数据加载: _______ 秒
- 启动后内存: _______ MB

数据加载性能:
- UnitsView 加载: _______ 秒
- SectionDetailView 加载: _______ 秒
- WordDetailView 加载: _______ 秒

音频播放性能:
- 完整音频启动: _______ 秒
- 音频片段启动: _______ 秒
- 音频切换响应: _______ 秒

UI 响应性能:
- 列表滚动 FPS: _______
- 按钮响应时间: _______ 秒
- 导航动画 FPS: _______
```

### 功能测试结果（待用户在 Mac 上填写）

```
测试日期: _______________

通过项数: _____ / _____
失败项数: _____
跳过项数: _____

主要问题:
1. _______________________
2. _______________________
3. _______________________
```

---

## 附录

### A. 测试工具

**Xcode 内置工具**:
- Time Profiler: 性能分析
- Allocations: 内存分析
- Leaks: 内存泄漏检测
- Network: 网络性能
- Energy Log: 能耗分析

**第三方工具**（可选）:
- SwiftLint: 代码风格检查
- Periphery: 未使用代码检测
- SonarQube: 代码质量分析

### B. 测试最佳实践

1. **在真机上测试**: 模拟器性能不能完全代表真机
2. **多次测量取平均值**: 减少测量误差
3. **记录测试环境**: 确保可重复性
4. **自动化测试**: 减少人工成本
5. **持续监控**: 每个阶段后重新测试

### C. 问题追踪模板

如果在测试中发现问题，使用以下模板记录：

```markdown
## 问题 #001

**标题**: [简短描述]
**严重程度**: 🔴高 / 🟡中 / 🟢低
**类型**: 功能 / 性能 / UI / 数据
**发现日期**: YYYY-MM-DD

**重现步骤**:
1.
2.
3.

**预期行为**:
[描述]

**实际行为**:
[描述]

**影响范围**:
[哪些功能受影响]

**建议修复**:
[如果有建议]
```

---

## 变更历史

| 日期 | 版本 | 变更描述 | 作者 |
|------|------|----------|------|
| 2025-11-11 | 1.0 | 初始基准测试文档创建 | Claude |

---

**文档结束**

**注意**: 本文档中标记为"TBM"（To Be Measured）和"⏳ 待测"的项目需要用户在 Mac 上使用 Xcode 实际测量并填写结果。
